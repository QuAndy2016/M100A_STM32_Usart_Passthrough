# M100A LoRaWAN串口数据透传模块使用说明

更新时间：2016/9/20

---

##模块的工作模式
###模块有两种工作模式：配置模式和透传模式。

- 配置模式
如何进入配置模式？在模块上电启动前通过将模块的MODE_SET引脚接高电平（3.3V or 5V）并一直保持，然后给模块上电或复位即可进入配置模式。
配置模式能做什么？进入配置模式后的模块只能进行模块的参数配置，配置参数可以使用M100A LoRaWAN配置工具进行相应的修改。
- 透传模式
如何进入透传模式？在模块上电启动前通过将模块的MODE_SET引脚接地或悬空，然后在给
模块上电或复位即可进入透传模式。 
透传模式能做什么？透传模式的工作过程：先按配置的参数加入网关，如果入网成功，则会
等待接收串口数据，当收到正确的串口数据后模块将把数据转发到服务器上，转发数据使用
的LoRaWAN协议端口为222，串口数据的最大长度和模块使用的数据率有关，详情见下表描
述。如果入网不成功，模块会每间隔10秒重新尝试入网，目前没做最大尝试入网次数限制。
####470MHz频段的数据率和Payload最长长度对应表
|数据速率编号|参数值|N(Bytes)|
|---|---|---|
|0 |SF12/125 kHz|51|
|1 |SF11/125 kHz|51|
|2 |SF10/125 kHz|51|
|3 |SF9/125 kHz|115|
|4 |SF8/125 kHz|222|
|5 |SF7/125 kHz|222|

##模块接口介绍

- 通讯串口
RX：模块丝印为UART1_RX，TX：模块丝印为UART1_TX。用于PC端配置模块和串口数据交互。
**外部MCU允许发送串口数据检测IO**：模块丝印STM8_RTS，低电平有效。
debug打印输出脚：模块丝印UART3_TX。
两组串口的参数均一致为：115200bps，8E1，无奇偶校验。不支持工具修改。
- 供电
VCC：模块丝印为VIN，GND：模块丝印为GND。
- 烧录
SWD方式，RESET：模块丝印为SX_RESET，SWDAT：模块丝印为SWDAT，SWCLK：模块丝印为SWCLK。
- LED指示
  模块上电启动时，LED会亮一秒后灭掉。
- 其他接口
目前其他接口均未使用。

##串口透传数据帧格式（协议）
|起始符|Payload长度|Payload|结束符|
|---|---|---|---|
|0xFE|1Byte|N Byte$^{（1）}$ |0xEF|

- Payload为实际需要传输的数据。
- 整个数据帧应小于或等于255字节。

1：N最大值请参照《470MHz频段的数据率和Payload最长长度对应表》。

###模块串口返回值说明
|返回值|帧内容（Hex）|说明|
|---|---|---|
|0x00|FE 01 **00** EF|模块透传数据发送失败|
|0xFF|FE 01 **FF** EF|模块透传数据发送成功|


---